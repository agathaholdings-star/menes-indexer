# サロン新規発見パイプライン設計メモ

作成日: 2026-02-04

## 背景・戦略

MEのデータに依存し続けると、いつまでもMEを超えられない。
独自のサロンマスタデータを構築することで差別化する。

## フェーズ構成

### フェーズ1: MEデータで立ち上げ
- MEから取得済みの初期データ（salon_db ~5,289店舗, therapist_db ~160K）を活用
- AI加工してコンテンツ生成 → アクセス集め
- ユーザーが口コミを投稿 → コンテンツが自走し始める

### フェーズ2: 独自データベース構築
- 口コミはユーザーから自然に溜まる
- サロンマスタデータ（店舗情報・セラピスト一覧・営業情報）を自前で構築
- MEに無い店舗を見つけ、ME以上に正確・最新な情報を持つ

---

## エリア設計（最重要・最上位概念）

### 基本方針

**エリア名 = 検索キーワード**として設計する。
地理的な都合ではなく、ユーザーの検索行動に基づいてエリアを定義する。

- 「渋谷 メンエス」で検索する人がいる → 「渋谷」を独立エリアとして作る
- 「恵比寿 メンエス」で検索する人がいる → 「恵比寿」を別エリアとして作る
- 検索キーワードが違うものを「渋谷・恵比寿」とまとめてはいけない
- エリア内にさらに検索ボリュームのあるサブ地名があれば、それも独立させる

### 構造

```
都道府県（47、固定）
  └── エリア（検索キーワードベースで事前定義、固定）
       └── サロン
```

- エリアマスタは事前に確定する（自動で増えない）
- 追加は運営判断で行う
- サロンが来るたびにエリアを作るのではない

### エリアマスタの作り方（TODO — 次回ここから再開）

検索ボリュームだけでは漏れが出る（ボリュームが無くてもサロンが存在するエリアがある）。
複数ソースを掛け合わせてエリアを決定する:

1. **キーワードリサーチ**: 「[地名] メンエス」の検索ボリュームを調査 → ボリュームがあれば確実に作る
2. **実際のサロン分布**: 既存5,289店舗がどこに集中しているか → ボリューム無くても店舗が複数あれば作る
3. **既存ME area_db（162エリア）**: MEもSEOベースで分けているため参考になる
4. **他ポータルのエリア分類**: メンズMG、fues.jp等のエリア区分も参考に

判断基準: **検索ボリューム × 実際のサロン存在数** の掛け合わせ

### 次回やること（具体的なステップ）

1. キーワードプランナー or ラッコキーワードで「[地名] メンエス」の検索ボリュームを一括調査
2. 既存salon_db 5,289店舗のエリア分布を集計（どの地域に何店舗あるか）
3. 上記を突き合わせて、独立エリアにするかどうかを判断
4. エリアマスタの最終リストを確定
5. 各エリアに所属する駅リストを紐付け（サロン振り分け用）

### ツール
- Google キーワードプランナー
- ラッコキーワード等

---

## 新規サロンURL発見の方針

### 方針: ポータルサイト監視

Google検索はSEOが強い順に並ぶため、新着店舗の発見には不向き。
同業ポータルサイトの「新着店舗」ページを定期監視する方が確実。

### 監視対象ポータル

#### メンズMG (mens-mg.com) — メイン
- URL: `https://mens-mg.com/newshop.php?p={page}`（prefなしで全国一覧）
- 新着店舗ページに**公式サイトURLが直接掲載**されている
- 取得可能データ: 店名、公式URL、最寄駅、営業時間、料金、オープン日
- 都道府県フィルタあり（pref=13で東京等）→ 全国対応可
- 全国で300件以上、11ページ以上
- ページネーションあり

#### 週刊エステ / フーエス (fues.jp) — 後回し
- URL: `https://www.fues.jp/{area}/i-japanese/?area=newest&page={page}`
- 新着順ソート可能
- 取得可能データ: 店名、駅名、料金、セラピスト出勤数
- **公式URLは一覧に無い** → 詳細ページ(`/store/{ID}/`)へ遷移が必要
- メンズMGで不足を感じたら追加検討

#### エスラブ (eslove.jp) — 要検討
- URL: `https://eslove.jp/kanto/tokyo/shoplist/newshop/`
- 403エラー（bot対策あり）→ 別手段が必要

### 補助的なアプローチ

1. **既存店舗からの芋づる式発見**: 5,289店舗の公式サイトから系列店・姉妹店リンクを抽出
2. **Google検索**: 網羅性チェック用。新着発見よりは既存の補完として使う
3. **MEデータを学習素材に**: 5,289店舗の公式サイトの特徴を分析し「メンエス判定プロンプト」を構築 → Google検索結果のフィルタに活用（自己強化ループ）

---

## 決定事項

### 1. スクレイピング対象
- **メンズMG `newshop.php`（prefなし全国一覧）** をメインで巡回
- fues.jpは後回し。メンズMG単体で回して不足を感じたら追加

### 2. 巡回頻度
- **週1回**

### 3. 重複チェック方法
- **公式URLのドメイン名で一致判定**
- 正規化: プロトコル(`https://`)、`www.`、パス以降を除去してドメイン部分のみ比較
- 例: `https://www.shirokano.jp/therapist/1` → `shirokano.jp`

### 4. サロンのエリア紐付け
- スクレイピング時は `prefecture`（都道府県）を必須格納、`area_id` は任意（NULL可）
- ポータルのエリア表記は参考値。正のエリア判定は自社定義の駅→エリアマッピングで行う
- マッピングに無い駅の場合は県レベルに置く

---

## パイプライン概要

```
【事前準備】
キーワードリサーチ → エリアマスタ確定 → 駅→エリアマッピング作成

【発見フロー】
ポータル新着ページを週1巡回（メンズMG全国）
  → 店名 + 公式URL + 最寄駅 + 都道府県を抽出
  → ドメイン名でsalon_dbと重複チェック
  → 新規 → salon_dbに追加（prefecture必須、area_idは駅マッピングで判定）
  → 公式サイト巡回Botがセラピスト取得開始
```

---

## 未決定事項（要検討）

1. **エリアマスタの具体的なリスト**: キーワードリサーチで確定する（最優先TODO）
2. **各エリアの所属駅リスト**: エリアマスタ確定後に作成
3. **salon_dbスキーマ変更**: 新フィールドの追加（source, discovered_date等）
4. **公式サイト巡回Botとの連携**: 追加後に自動でセラピスト取得を開始する仕組み
5. **実行環境**: 既存VPS(162.43.14.182)？別環境？cronジョブの設定
6. **エラー処理・ログ**: 失敗時の対応方針

---

## 既存インフラ（参考）

- Supabase DB: area_db(162エリア), salon_db(5,289店舗), therapist_db(~160K)
- 稼働中パイプライン: ME新着口コミ → newly_reviews_unified.py → DB更新
- AI記事投稿: therapist_db → AI review生成 → VPS WordPress自動投稿(1000件/日)
- 投稿状況(2/3時点): 130,618件投稿済み / 残り約13,158件

### area_db 現状スキーマ
```
area_id, area_name, area_url(ME依存), prefecture, district,
created_at, updated_at, area_description, area_meta_title, area_meta_description
```
162エリア。prefecture単位（東京都、千葉県、京都府等）の下にエリア名（高田馬場、北千住、調布・登戸等）。
