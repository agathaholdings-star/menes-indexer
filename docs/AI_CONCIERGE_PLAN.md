# Gemini活用型 メンズエステ・インデクサー 要件定義書 (復元版)

元々の戦略サマリー (`STRATEGY_SUMMARY_20260123.md`) および開発計画 (`.cursor/plans/`) に基づき、**Google Gemini** を中核に据えたシステム要件定義を再構築しました。

## 1. プロジェクトコアコンセプト
**「検索 (Search)」から「提案 (Discovery)」へ**
従来のデータベース型検索ではなく、Geminiの言語処理能力と推論能力を活用し、ユーザーの潜在的なニーズ（性癖・気分）を汲み取って最適なセラピストを提案する「AIコンシェルジュ」サービスを構築する。

---

## 2. Gemini 活用アーキテクチャ

### 採用モデル
*   **Gemini 1.5 Flash**: 主力モデル。圧倒的な低コストと高速なレスポンス、長いコンテキストウィンドウを活かし、大量のデータ処理とリアルタイム応答を担当。
*   **Gemini 1.5 Pro**: 高精度モデル。複雑な推論や、特に「際どい」表現のニュアンス理解・安全なフィルタリングが必要な箇所で使用。

### AIが担当する3つの主要機能

#### A. データ構造化パイプライン (Data Structuring)
スクレイピングした非構造化データ（自由記述の口コミ、ブログ、HP文章）をGeminiに解析させ、検索可能な**「構造化データ」**に変換する。

*   **入力**: 店舗ブログ、セラピストの自己紹介、ユーザーの口コミ（長文）
*   **処理**: Gemini 1.5 Flash にテキストを投げ、以下のJSONスキーマで抽出。
*   **出力**:
    *   `looks_type`: [清楚, ギャル, ロリ, お姉さん, モデル]
    *   `style_type`: [スレンダー, 普通, むちむち, グラマー]
    *   `play_style`: [癒やし重視, 密着重視, 会話重視, 技術重視]
    *   `contact_level`: 1〜5 (密着度スコア)
    *   `tags`: ["#ノリが良い", "#サバサバ系", "#彼氏感覚"]

#### B. コンテンツ自動生成 (Content Generation)
SEOに強く、ユーザーが読みたくなる紹介文を大量生成する。

*   **機能**: **「AIプロフィール要約」**
    *   複数のソース（公式HP、他サイトの口コミ）を統合し、「この子はどんな子か？」を300文字程度で魅力的にまとめる。
    *   Geminiの長文コンテキスト耐性を活かし、過去数ヶ月分のブログを一気に読み込ませ、「最近の出勤傾向」や「客層」まで分析させることも可能。

#### C. AIコンシェルジュ診断 (Real-time Discovery)
ユーザーとの対話、または選択式フォームの結果をもとに、ベストなセラピストを提案する。

*   **機能**: **「AIマッチング診断」**
    *   ユーザー入力：「今日は仕事で疲れたから、あまり喋らずに密着して甘えさせてくれる、グラマーな子がいい」
    *   Gemini処理：
        1.  入力を解析し、検索クエリに変換 (`play_style:癒やし` AND `contact_level:High` AND `style:グラマー`)
        2.  DBから候補をピックアップ。
        3.  **「なぜこの子がおすすめか」** という推薦コメントを動的に生成して提示。

---

## 3. データフローとデータベース設計 (Supabase)

Geminiの出力を格納するためのスキーマ設計。

### `therapists` テーブル拡張
既存のカラムに加え、AI生成データを格納するカラムを追加。

| カラム名 | データ型 | 説明 | 生成元 |
| :--- | :--- | :--- | :--- |
| `ai_summary` | TEXT | AIが生成した紹介文・要約 | Gemini (Batch) |
| `looks_type` | TEXT | ルックス系統（構造化タグ） | Gemini (Extraction) |
| `contact_level` | INT | 密着度スコア (1-5) | Gemini (Extraction) |
| `ai_tags` | TEXT[] | 特徴タグ配列 (例: ["#色白", "#聞き上手"]) | Gemini (Extraction) |
| `embedding` | VECTOR | ベクトル検索用データ（将来的な類似検索用） | Gemini Embedding |

---

## 4. 開発フェーズ (Gemini実装計画)

既存の `Development Plan` をGeminiベースに修正。

### Phase 1: データ基盤構築 (Batch Processing)
1.  **スクリプト作成**: `scripts/ai_enrichment.ts`
    *   Supabaseから未処理のセラピストデータを取得。
    *   Gemini API を叩き、要約と構造化タグを生成。
    *   結果をSupabaseにUpdate。
2.  **プロンプトエンジニアリング**:
    *   メンズエステ特有の隠語やニュアンスを理解し、適切にカテゴリ分けするためのシステムプロンプトを開発。

### Phase 2: ユーザーインターフェース (Frontend)
1.  **AIタグ表示**: セラピスト詳細画面に、AIが抽出したタグと要約を表示。
2.  **診断ウィザード**:
    *   「気分」や「好み」を選ぶUI。
    *   裏側でGeminiが解釈可能なクエリに変換するロジック。

### Phase 3: AIコンシェルジュ (Chat UI)
1.  **チャットボット実装**:
    *   Vercel AI SDK + Google Gemini Provider を使用。
    *   ストリーミング応答による高速な対話体験。

---

## 5. コスト戦略
*   **Gemini 1.5 Flash** を採用することで、他社LLM（GPT-4o, Claude 3.5 Sonnet）と比較して**1/10〜1/20のコスト**で運用可能。
*   大量の初期データ処理（過去の口コミ数万件の解析）も、Geminiなら現実的な予算（数百円〜数千円程度）で完了できるため、スタートアップに最適。
